# Optimization Update: AI Agent & Robustness

This update transforms `simple_quant` into an autonomous quantitative research platform. It now features an AI Agent capable of generating, testing, and fixing trading strategies automatically.

## 1. The AI Strategy Agent

We have introduced a **"Code-Gen" Loop** that allows you to describe a strategy in English, and the system will write the Python code, backtest it, and iterate if errors occur.

### Components
- **Manager (`agent/manager.py`)**: The brain that orchestrates the generation loop.
- **Executor (`agent/executor.py`)**: A sandboxed environment that runs generated code dynamically.
- **Context (`agent/context.py`)**: Provides the LLM with the API documentation of our framework.
- **Client (`agent/client.py`)**: Connects to any OpenAI-compatible LLM endpoint (e.g., LocalAI, vLLM, DeepSeek).

### How to Use
1. **Configure Model**:
   Edit `.env` in the project root:
   ```env
   MODEL_URL=http://localhost:11434/v1/chat/completions
   MODEL_API_KEY=your-key
   MODEL_NAME=deepseek-coder
   ```

2. **Run the Agent**:
   ```bash
   # Interactive Mode
   python stock_playground/agent/manager.py

   # Direct Command
   python stock_playground/agent/manager.py "Mean reversion using RSI and Bollinger Bands"
   ```

3. **Output**:
   Strategies are saved in `stock_playground/generated_strategies/` with:
   - `strategy.py`: The source code.
   - `meta.json`: Performance metrics (Sharpe, Stability Score) from the training period.

## 2. Robust Portfolio Engine

We replaced the naive portfolio with a **RobustPortfolio** (`simple_quant/portfolio/simple.py`).
- **Real-time Risk Checks**: Verifies cash balance before buying.
- **Exit Logic**: Properly handles `EXIT` signals to close positions.
- **Mark-to-Market**: Updates equity based on daily closing prices.
- **Advanced Metrics**: Calculates **Stability Score**, **Calmar Ratio**, and **Sortino Ratio**.

## 3. Data & Tools

### TDX Data Source
- **Script**: `stock_playground/scripts/fetch_tdx_data.py`
- Fetches high-quality 5-year history for A-shares via `pytdx`.

### Universal Backtest Runner
- **Script**: `stock_playground/run_universal_backtest.py`
- Automatically runs a benchmark backtest on ALL data files found in `data/`.

### Parameter Exploration
- **Script**: `stock_playground/explore_strategies.py`
- Performs Grid Search on standard strategies (SMA, RSI) with **Train/Test Split** validation to find robust parameters.

## 4. Workflow Recommendation

1. **Acquire Data**: Run `fetch_tdx_data.py`.
2. **Generate Ideas**: Use the **Agent** to create 5-10 different strategy concepts.
3. **Validate**: The Agent automatically validates them on the training set (2020-2023).
4. **Production Test**: Use `run_universal_backtest.py` or manually load the generated strategy files to test on 2024 data.

---
*Generated by Antigravity Agent*
